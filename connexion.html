<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Connexion</title>
<style>
body { font-family: Arial; padding: 20px; }
input, select, button { display: block; margin: 10px 0; padding: 10px; width: 100%; max-width: 400px; }
button { background-color: #28a745; color: white; border: none; cursor: pointer; }
button:hover { background-color: #1e7e34; }
</style>
</head>
<body>

<h2>Connexion</h2>

<select id="pays">
  <option value="">Sélectionner un pays</option>
  <option value="Burkina Faso" data-code="+226">Burkina Faso</option>
  <option value="Côte d'Ivoire" data-code="+225">Côte d'Ivoire</option>
  <option value="Mali" data-code="+223">Mali</option>
  <!-- ajoute d'autres pays avec Orange Money ici -->
</select>

<input type="text" id="codePays" placeholder="Code pays" readonly>
<input type="text" id="numero" placeholder="Numéro">
<input type="password" id="motDePasse" placeholder="Mot de passe">

<button id="btnConnexion">Se connecter</button>

<p>Pas encore de compte ? <a href="inscription.html">Inscrivez-vous</a></p>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'https://bokfeyyczhzreolydjly.supabase.co'
const supabaseKey = 'sb_publishable_5DXFVEW-wWVm-sMaLjrSCg_9U4OR4dW'
const supabase = createClient(supabaseUrl, supabaseKey)

// Mise à jour automatique du code pays
document.getElementById('pays').addEventListener('change', function() {
  const code = this.selectedOptions[0].dataset.code || '';
  document.getElementById('codePays').value = code;
})

// Bouton connexion
document.getElementById('btnConnexion').addEventListener('click', async () => {
  const pays = document.getElementById('pays').value
  const codePays = document.getElementById('codePays').value
  const numero = document.getElementById('numero').value
  const mot_de_passe = document.getElementById('motDePasse').value

  if (!pays || !numero || !mot_de_passe) {
    alert('Veuillez remplir tous les champs')
    return
  }

  // Vérifier si l'utilisateur existe
  const { data, error } = await supabase
    .from('users')
    .select('*')
    .eq('numero', numero)
    .eq('mot_de_passe', mot_de_passe)

  if (error) {
    alert('Erreur : ' + error.message)
  } else if (data.length === 0) {
    alert('Utilisateur non trouvé ou mot de passe incorrect')
  } else {
    alert('Connexion réussie ! Redirection vers l’accueil...')
    // Ici, tu peux stocker l'utilisateur connecté pour l'afficher sur l'accueil
    localStorage.setItem('user', JSON.stringify(data[0]))
    window.location.href = 'accueil.html'
  }
})
</script>
</body>
</html>